{{>navbar username=username}}
<div id="pagebody">
    <h1>Μέσος Όρος: <span id="avggrade"></span></h1>
    <div class="formdiv">
        <form method="post">
            <div class="year" id="year1">
                <div class="semester form-group" id="semester1">
                    <legend>1o Εξάμηνο</legend>
                    {{#each courses1}}
                    <div class="course" id="{{this.courseCode}}">
                        <label for="grade" >{{this.courseName}}<span type="number" id="weight" value="{{this.syntelestis}}" hidden>{{this.syntelestis}}</span></label>
                        <input name={{this.courseCode}} type="number" class="form-control" id="grade" step="0.5" min="0" max="10">
                    </div>
                    {{/each}}
                </div>
                <div class="semester form-group" id="semester2">
                    <legend>2o Εξάμηνο</legend>
                    {{#each courses2}}
                    <div class="course" id="{{this.courseCode}}">
                        <label for="grade" >{{this.courseName}}<span type="number" id="weight" value="{{this.syntelestis}}" hidden>{{this.syntelestis}}</span></label>
                        <input name={{this.courseCode}} type="number" class="form-control" id="grade" step="0.5" min="0" max="10">
                    </div>
                    {{/each}}
                </div>
            </div>
            <div class="year" id="year2">
                <div class="semester form-group" id="semester3">
                    <legend>3o Εξάμηνο</legend>
                    {{#each courses3}}
                    <div class="course" id="{{this.courseCode}}">
                        <label for="grade" >{{this.courseName}}<span type="number" id="weight" value="{{this.syntelestis}}" hidden>{{this.syntelestis}}</span></label>
                        <input name={{this.courseCode}} type="number" class="form-control" id="grade" step="0.5" min="0" max="10">
                    </div>
                    {{/each}}
                </div>
                <div class="semester form-group" id="semester4">
                    <legend>4o Εξάμηνο</legend>
                    {{#each courses4}}
                    <div class="course" id="{{this.courseCode}}">
                        <label for="grade" >{{this.courseName}}<span type="number" id="weight" value="{{this.syntelestis}}" hidden>{{this.syntelestis}}</span></label>
                        <input name={{this.courseCode}} type="number" class="form-control" id="grade" step="0.5" min="0" max="10">
                    </div>
                    {{/each}}
                </div>
            </div>
            <div class="year" id="year3">
                <div class="semester form-group" id="semester5">
                    <legend>5o Εξάμηνο</legend>
                    {{#each courses5}}
                    <div class="course" id="{{this.courseCode}}">
                        <label for="grade" >{{this.courseName}}<span type="number" id="weight" value="{{this.syntelestis}}" hidden>{{this.syntelestis}}</span></label>
                        <input name={{this.courseCode}} type="number" class="form-control" id="grade" step="0.5" min="0" max="10">
                    </div>
                    {{/each}}
                </div>
                <div class="semester form-group" id="semester6">
                    <legend>6o Εξάμηνο</legend>
                    {{#each courses6}}
                    <div class="course" id="{{this.courseCode}}">
                        <label for="grade" >{{this.courseName}}<span type="number" id="weight" value="{{this.syntelestis}}" hidden>{{this.syntelestis}}</span></label>
                        <input name={{this.courseCode}} type="number" class="form-control" id="grade" step="0.5" min="0" max="10">
                    </div>
                    {{/each}}
                </div>
            </div>
            <div class="year" id="year4">
                {{#if courses7}}
                <div class="semester form-group" id="semester7">
                    <legend>7o Εξάμηνο</legend>
                    {{#each courses7}}
                    <div class="course" id="{{this.courseCode}}">
                        <label for="grade" >{{this.courseName}}<span type="number" id="weight" value="{{this.syntelestis}}" hidden>{{this.syntelestis}}</span></label>
                        <input name={{this.courseCode}} type="number" class="form-control" id="grade" step="0.5" min="0" max="10">
                    </div>
                    {{/each}}
                </div>
                {{else}}
                <div class="semester form-group" id="semester7">
                    <legend>7o Εξάμηνο</legend>
                    <div class="course">
                        <input type="text" placeholder="Μάθημα 1" name="course71">
                        <input type="number" id="grade71" name="grade71" min="0" max="10" step="0.5" required>
                        <label class="switch">
                            <input type="checkbox" name="synt71c" id="synt71c"> 
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="course">
                        <input type="text" placeholder="Μάθημα 2" name="course72">
                        <input type="number" id="grade71" name="grade72" min="0" max="10" step="0.5" required>
                        <label class="switch">
                            <input type="checkbox" name="synt72c" id="synt72c"> 
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="course">
                        <input type="text" placeholder="Μάθημα 3" name="course73">
                        <input type="number" id="grade73" name="grade73" min="0" max="10" step="0.5" required>
                        <label class="switch">
                            <input type="checkbox" name="synt73c" id="synt73c"> 
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="course">
                        <input type="text" placeholder="Μάθημα 4" name="course74">
                        <input type="number" id="grade74" name="grade74" min="0" max="10" step="0.5" required>
                        <label class="switch">
                            <input type="checkbox" name="synt74c" id="synt74c"> 
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="course">
                        <input type="text" placeholder="Μάθημα 5" name="course75">
                        <input type="number" id="grade75" name="grade75" min="0" max="10" step="0.5" required>
                        <label class="switch">
                            <input type="checkbox" name="synt75c" id="synt75c"> 
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="course">
                        <input type="text" placeholder="Μάθημα 6" name="course76">
                        <input type="number" id="grade76" name="grade76" min="0" max="10" step="0.5" required>
                        <label class="switch">
                            <input type="checkbox" name="synt76c" id="synt76c"> 
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>  
                {{/if}}
                {{#if courses8}}
                <div class="semester form-group" id="semester8">
                    <legend>8o Εξάμηνο</legend>
                    {{#each courses8}}
                    <div class="course" id="{{this.courseCode}}">
                        <label for="grade" >{{this.courseName}}<span type="number" id="weight" value="{{this.syntelestis}}" hidden>{{this.syntelestis}}</span></label>
                        <input name={{this.courseCode}} type="number" class="form-control" id="grade" step="0.5" min="0" max="10">
                    </div>
                    {{/each}}
                </div>
                {{else}}
                <div class="semester form-group" id="semester8">
                    <legend>8o Εξάμηνο</legend>
                    <div class="course">
                        <input type="text" placeholder="Μάθημα 1" name="course81">
                        <input type="number" id="grade81" name="grade81" min="0" max="10" step="0.5" required>
                        <label class="switch">
                            <input type="checkbox" name="synt81c" id="synt81c"> 
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="course">
                        <input type="text" placeholder="Μάθημα 2" name="course82">
                        <input type="number" id="grade81" name="grade82" min="0" max="10" step="0.5" required>
                        <label class="switch">
                            <input type="checkbox" name="synt82c" id="synt82c"> 
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="course">
                        <input type="text" placeholder="Μάθημα 3" name="course83">
                        <input type="number" id="grade83" name="grade83" min="0" max="10" step="0.5" required>
                        <label class="switch">
                            <input type="checkbox" name="synt83c" id="synt83c"> 
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="course">
                        <input type="text" placeholder="Μάθημα 4" name="course84">
                        <input type="number" id="grade84" name="grade84" min="0" max="10" step="0.5" required>
                        <label class="switch">
                            <input type="checkbox" name="synt84c" id="synt84c"> 
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="course">
                        <input type="text" placeholder="Μάθημα 5" name="course85">
                        <input type="number" id="grade85" name="grade85" min="0" max="10" step="0.5" required>
                        <label class="switch">
                            <input type="checkbox" name="synt85c" id="synt85c"> 
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="course">
                        <input type="text" placeholder="Μάθημα 6" name="course86">
                        <input type="number" id="grade86" name="grade86" min="0" max="10" step="0.5" required>
                        <label class="switch">
                            <input type="checkbox" name="synt86c" id="synt86c"> 
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>  
                {{/if}}
            </div>
            <div class="year" id="year5">
                 {{#if courses9}}
                <div class="semester form-group" id="semester9">
                    <legend>9o Εξάμηνο</legend>
                    {{#each courses9}}
                    <div class="course" id="{{this.courseCode}}">
                        <label for="grade" >{{this.courseName}}<span type="number" id="weight" value="{{this.syntelestis}}" hidden>{{this.syntelestis}}</span></label>
                        <input name={{this.courseCode}} type="number" class="form-control" id="grade" step="0.5" min="0" max="10">
                    </div>
                    {{/each}}
                </div>
                {{else}}
                <div class="semester form-group" id="semester9">
                    <legend>9o Εξάμηνο</legend>
                    <div class="course">
                        <input type="text" placeholder="Μάθημα 2" name="course91">
                        <input type="number" id="grade91" name="grade91" min="0" max="10" step="0.5" required>
                        <label class="switch">
                            <input type="checkbox" name="synt91c">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="course">
                        <input type="text" placeholder="Μάθημα 2" name="course92">
                        <input type="number" id="grade92" name="grade92" min="0" max="10" step="0.5" required>
                        <label class="switch">
                            <input type="checkbox" name="synt92c">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="course">
                        <input type="text" placeholder="Μάθημα 3" name="course93">
                        <input type="number" id="grade93" name="grade93" min="0" max="10" step="0.5" required>
                        <label class="switch">
                            <input type="checkbox" name="synt93c">
                            <span class="slider round"></span>
                        </label>
                    </div>  
                    <div class="course">
                        <input type="text" placeholder="Μάθημα 4" name="course94">
                        <input type="number" id="grade94" name="grade94" min="0" max="10" step="0.5" required>
                        <label class="switch">
                            <input type="checkbox" name="synt94c">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>  
                {{/if}}
                <div class="semester form-group" id="semester10">
                    <legend>10o Εξάμηνο</legend>
                    {{#each courses10}}
                    <div class="course" id="{{this.courseCode}}">
                        <label for="grade" >{{this.courseName}}<span type="number" id="weight" value="{{this.syntelestis}}" hidden>{{this.syntelestis}}</span></label>
                        <input name={{this.courseCode}} type="number" class="form-control" id="grade" step="0.5" min="0" max="10">
                    </div>
                    {{/each}}
                </div>
            </div>
            <div id="submitcont">
                <button class="btn btn-primary" id="gradessubmit" type="submit" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        fetch('/api/grades')
            .then(response => response.json())
            .then(data => {
                console.log(data);
                data.forEach(course => {
                    const input = document.querySelector(`input[name="${course.course}"]`);
                    if (input) {
                        input.value = course.grade;
                    }
                });
            }).
            then(() => calculateAverageGrade())
            .catch(error => console.error(error));

            const calculateAverageGrade = () => {
                const inputs = document.querySelectorAll('input[type="number"]');
                const weights = document.querySelectorAll('span#weight');
                let totalWeight = 0;
                let weightedSum = 0;

                inputs.forEach((input, index) => {
                    const value = parseFloat(input.value);
                    const weight = parseFloat(weights[index].textContent);
                    if (!isNaN(value) && !isNaN(weight) && value >= 5 && value <= 10) {
                        weightedSum += value * weight;
                        totalWeight += weight;
                    }
                });

                const avgGrade = (totalWeight === 0) ? 0 : (weightedSum / totalWeight).toFixed(2);
                document.getElementById('avggrade').textContent = avgGrade;
            };

            
            
    });

    
  

    document.addEventListener('input', (event) => {
        const inputs = document.querySelectorAll('input[type="number"]');
        const weights = document.querySelectorAll('#weight');
        const values = Array.from(inputs).map(input => input.value);
        const weightsValues = Array.from(weights).map(weight => Number(weight.textContent));
        console.log(values);
        console.log(weightsValues);

        
    
    let totalWeight = 0;
    let weightedSum = 0;

    inputs.forEach((input, index) => {
        const value = parseFloat(input.value);
        if (!isNaN(value) && value !== 0  && value >= 5 && value <= 10) {
            const weight = weightsValues[index];
            weightedSum += value * weight;
            totalWeight += weight;
        }
    });

    const avgGrade = (totalWeight === 0) ? 0 : (weightedSum / totalWeight).toFixed(2);
    document.getElementById('avggrade').textContent = avgGrade;

    });

  


</script>